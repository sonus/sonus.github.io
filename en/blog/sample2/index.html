<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/sonus-logo.svg">

  <title>
    Fixing Heavy JWTs: Bitmasking for Lean &amp; Scalable Permissions - Sonus Sundar - Full-stack Software Engineer
  </title>
  <meta name="description" content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps." /><meta name="generator" content="Hugo 0.128.0">
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
        .dark .header-path {
          stroke: #FFF;
        }
        .logo-path {
    stroke: #000;
    stroke-width: 1;
  stroke-dasharray: 100;
  animation: dash 3s linear infinite;
}

@keyframes dash {
  to {
    stroke-dashoffset: 1000;
  }
}
</style>
  
  

  <meta property="og:url" content="http://localhost:1313/en/blog/sample2/">
  <meta property="og:site_name" content="Sonus Sundar - Full-stack Software Engineer">
  <meta property="og:title" content="Fixing Heavy JWTs: Bitmasking for Lean &amp; Scalable Permissions">
  <meta property="og:description" content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-07-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-27T00:00:00+00:00">
    <meta property="article:tag" content="Fat Jwt">
    <meta property="article:tag" content="Heavy Jwt">
    <meta property="article:tag" content="Jwt">
    <meta property="article:tag" content="Bitmasking">
    <meta property="article:tag" content="413 Request Entity Too Large">
    <meta property="article:tag" content="414 URI Too Long">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Fixing Heavy JWTs: Bitmasking for Lean &amp; Scalable Permissions">
  <meta name="twitter:description" content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps.">

  
  <meta itemprop="name" content="Fixing Heavy JWTs: Bitmasking for Lean &amp; Scalable Permissions">
  <meta itemprop="description" content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps.">
  <meta itemprop="datePublished" content="2025-07-27T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-07-27T00:00:00+00:00">
  <meta itemprop="wordCount" content="1347">
  <meta itemprop="keywords" content="Fat Jwt,Heavy Jwt,Jwt,Bitmasking,413 Request Entity Too Large,414 URI Too Long,400 Bad Request,Request Header Too Large,Header Size Exceeds Configuration Limit,Client Sent Too Large Request Header,Upstream Sent Too Big Header,Request Header Fields Too Large,HTTP 431,NGINX 400 Error,NGINX 413 Error,NGINX 414 Error,Apache 431 Error,Large Request Header Error,Header Buffer Size Error,Large_headers,Oversized_request_header,Reverse Proxy Error,Web Server Error">
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
  <a href="http://localhost:1313/en/" class="capitalize font-extrabold text-2xl"style="transform: rotate(270deg);">
    
    <svg class="max-w-full" width="100" height="120" viewBox="0 0 100 120" fill="none"
  xmlns="http://www.w3.org/2000/svg">
  <path class="logo-path"  d="M20.6565 10.2626 L50.3904 79.3435 L79.5415 10.8006 L10.2906 60.4069 L50.3904 110.312 L89.7094 60.4069 L20.6565 10.2626 Z"></path>
</svg>
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">

    
    <li><a href="/en/blog">Blog</a></li>
    
    <li><a href="/en/page/about/">About</a></li>
    
    <li><a href="/en/tags">Tags</a></li>
    

    

    
    <li class="grid place-items-center">
      <span class="open-search inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="10" cy="10" r="7" />
          <line x1="21" y1="21" x2="15" y2="15" />
        </svg>
      </span>
    </li>
    

    
    <li class="grid place-items-center">
      <span class="toggle-dark-mode inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="3" />
          <line x1="12" y1="5" x2="12" y2="5.01" />
          <line x1="17" y1="7" x2="17" y2="7.01" />
          <line x1="19" y1="12" x2="19" y2="12.01" />
          <line x1="17" y1="17" x2="17" y2="17.01" />
          <line x1="12" y1="19" x2="12" y2="19.01" />
          <line x1="7" y1="17" x2="7" y2="17.01" />
          <line x1="5" y1="12" x2="5" y2="12.01" />
          <line x1="7" y1="7" x2="7" y2="7.01" />
        </svg>
      </span>
    </li>
    
  </ul>
</header><main class="flex-1">
  
  

  
  <div class="relative max-w-5xl mx-auto px-4">
    <img src="https://picsum.photos/id/186/800/500" class="rounded-lg shadow-sm w-full object-contain" />
    <div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">
      
  
    July 27, 2025
  


    </div>
  </div>
  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">Fixing Heavy JWTs: Bitmasking for Lean &amp; Scalable Permissions</h1>
    <h5 class="text-sm flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on 
  
    July 27, 2025
  


      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      7&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      1347&nbsp;words
      
    </h5>

    <p>Ever hit a wall with an error message that just screams, &ldquo;Dude, you&rsquo;re sending too much data!&rdquo; Or maybe your shiny, new Single Page Application (SPA) suddenly starts acting weird, requests dropping like flies? Yeah, I&rsquo;ve been there. For us, the culprit turned out to be our good old friend, the <strong>JSON Web Token (JWT)</strong>, specifically when it got absolutely <em>packed</em> with permissions and claims. What started as a neat, efficient way to handle authorization quickly spiraled into a monster that was literally too big for its britches.</p>
<hr>
<h3 id="the-problem-when-jwts-get-greedy">The Problem: When JWTs Get Greedy</h3>
<p>Here&rsquo;s what I&rsquo;ve been through: I started with basic JWT claims, just <code>iss</code>, <code>exp</code>, <code>iat</code>, <code>userid</code>, and <code>email</code>. It typically looks something like this (decoded for clarity):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#6272a4">// Example of a basic, decoded JWT payload
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;iss&#34;</span>: <span style="color:#f1fa8c">&#34;your-auth-server.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;exp&#34;</span>: <span style="color:#bd93f9">1735689600</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;iat&#34;</span>: <span style="color:#bd93f9">1704067200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;userid&#34;</span>: <span style="color:#f1fa8c">&#34;user123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;user@example.com&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then came the permissions. Initially, a few dozen strings for services like <code>USER_CREATE</code>, <code>PRODUCT_VIEW</code>, etc., were fine. But then permissions got <em>really</em> granular. Think <code>INVENTORY_ITEM_CREATE_BATCH</code>, <code>SALES_REPORT_VIEW_BY_REGION</code>. Suddenly, that <code>permissions</code> array wasn&rsquo;t just a few dozen strings; it was hundreds, sometimes thousands.</p>
<p>Here&rsquo;s a glimpse of what an overstuffed JWT payload looked like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#6272a4">// Example of an overstuffed JWT payload
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;iss&#34;</span>: <span style="color:#f1fa8c">&#34;your-auth-server.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;exp&#34;</span>: <span style="color:#bd93f9">1735689600</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;iat&#34;</span>: <span style="color:#bd93f9">1704067200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;userid&#34;</span>: <span style="color:#f1fa8c">&#34;user_with_all_the_permissions&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;email&#34;</span>: <span style="color:#f1fa8c">&#34;user@example.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;permissions&#34;</span>: [
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;USER_CREATE&#34;</span>, <span style="color:#f1fa8c">&#34;USER_READ&#34;</span>, <span style="color:#f1fa8c">&#34;PRODUCT_VIEW&#34;</span>, <span style="color:#f1fa8c">&#34;ORDER_CREATE&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;INVENTORY_ADD&#34;</span>, <span style="color:#f1fa8c">&#34;SALES_VIEW_ALL&#34;</span>, <span style="color:#f1fa8c">&#34;REPORT_GENERATE_FINANCIAL&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// ... many, many more. This list alone could easily push the JWT well past 4KB when encoded.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="lets-talk-numbers-calculating-jwt-size">Let&rsquo;s Talk Numbers: Calculating JWT Size</h3>
<p>So, how does a few dozen permissions turn into a monster token? It&rsquo;s simple math, really, plus a bit of JSON and Base64 encoding overhead. The size issue almost always comes down to the <strong>Payload</strong>.</p>
<p>Let&rsquo;s break down the approximate size contributors:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Component</th>
<th style="text-align:left">Estimated JSON Characters/Bytes</th>
<th style="text-align:left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>JWT Header (JSON String)</strong></td>
<td style="text-align:left">~40 characters</td>
<td style="text-align:left">Example: <code>{&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Fixed Payload Claims (JSON String)</strong></td>
<td style="text-align:left">~200 characters</td>
<td style="text-align:left"><code>iss</code>, <code>exp</code>, <code>iat</code>, <code>userid</code>, <code>email</code>, plus the <code>permissions</code> array structure <code>{&quot;permissions&quot;:[]}</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Average Permission String Length</strong></td>
<td style="text-align:left">10 characters</td>
<td style="text-align:left">E.g., <code>USER_CREATE</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Overhead per Permission in Array</strong></td>
<td style="text-align:left">~3 characters</td>
<td style="text-align:left">For quotes (<code>&quot;&quot;</code>) and comma (<code>,</code>) in JSON, i.e., <code>&quot;PERMISSION&quot;,</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Effective Length per Permission in JSON Payload</strong></td>
<td style="text-align:left"><strong>13 characters</strong></td>
<td style="text-align:left">(10 characters for string + 3 characters for overhead)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Base64Url Encoding Overhead</strong></td>
<td style="text-align:left">~33%</td>
<td style="text-align:left">Converts 3 bytes of raw data into 4 Base64 characters</td>
</tr>
<tr>
<td style="text-align:left"><strong>JWT Signature (Encoded)</strong></td>
<td style="text-align:left">~43 bytes</td>
<td style="text-align:left">Fixed size for HS256 algorithm</td>
</tr>
</tbody>
</table>
<p>To hit those common HTTP header limits, like 4KB or 8KB, it doesn&rsquo;t take as many permissions as you&rsquo;d think. Based on these numbers, having around <strong>200-220 permissions</strong>, each just 10 characters long, can easily push your encoded JWT to over <strong>4.5 KB</strong>. This immediately puts you at risk of those dreaded &ldquo;Request Header Fields Too Large&rdquo; errors from your web server or proxy.</p>
<hr>
<h3 id="solution-bitmasking-to-the-rescue">Solution: Bitmasking to the Rescue!</h3>
<p>Okay, so we&rsquo;ve got this heavy JWT problem. What&rsquo;s the fix? Well, I gotta tell you, I was doing some digging, and I stumbled across how Linux handles permissions using bitmasking—it&rsquo;s both efficient and incredibly scalable. Lightbulb moment! I figured, &ldquo;Hey, if it works for Linux, why can&rsquo;t we use this magic for our JWT permissions, especially now that they&rsquo;re multiplying like rabbits?&rdquo;</p>
<hr>
<h3 id="-from-linux-permissions-to-our-lean-mean-jwt-system">🔐 From Linux Permissions to Our Lean, Mean JWT System</h3>
<p>In Linux, file permissions are a classic example of bitmasking in action. Each permission—<strong>read (r)</strong>, <strong>write (w)</strong>, and <strong>execute (x)</strong>—is represented by a specific bit. Combine them, and boom – you&rsquo;ve got a permission mask.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Role</th>
<th style="text-align:left">Binary</th>
<th style="text-align:left">Octal</th>
<th style="text-align:left">Symbolic</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Owner</td>
<td style="text-align:left">111</td>
<td style="text-align:left">7</td>
<td style="text-align:left">rwx</td>
</tr>
<tr>
<td style="text-align:left">Group</td>
<td style="text-align:left">101</td>
<td style="text-align:left">5</td>
<td style="text-align:left">r-x</td>
</tr>
<tr>
<td style="text-align:left">Others</td>
<td style="text-align:left">101</td>
<td style="text-align:left">5</td>
<td style="text-align:left">r-x</td>
</tr>
</tbody>
</table>
<p>Inspired by this efficiency, I cooked up a <strong>JWT-based permission model using bitmasking</strong> in PHP. Instead of slapping in a bunch of separate flags, we assign each permission a unique bit, like <code>1 &lt;&lt; n</code>.</p>
<p>Here&rsquo;s how we set up our permission flags:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff79c6">const</span> PERMISSION_FLAGS <span style="color:#ff79c6">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;BLOG_CREATE&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">0</span>,  <span style="color:#6272a4">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#34;BLOG_READ&#34;</span>   <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">1</span>,  <span style="color:#6272a4">// 2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#34;BLOG_UPDATE&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">2</span>,  <span style="color:#6272a4">// 4
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#34;PERMISSION_64&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">63</span> <span style="color:#6272a4">// A whopping 2^63!
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>];
</span></span></code></pre></div><h4 id="-why-this-works-so-darn-well">🔍 Why this works so darn well:</h4>
<ul>
<li><strong>Scalable</strong>: You can handle up to 64 distinct permissions in a single 64-bit integer. And here&rsquo;s the cool part: if you need even more, you can simply use multiple integers to represent hundreds or even thousands of permissions, chaining them together. <strong>A common strategy is to have separate masks for different service areas (e.g., <code>blogPermissionsMask</code>, <code>userPermissionsMask</code>, <code>orderPermissionsMask</code>).</strong> <em>(Managing these advanced multi-mask architectures is a fantastic topic for a deeper dive!)</em> But often, 64 is plenty for many granular systems.</li>
<li><strong>Compact</strong>: We only need one integer (or a few, if you&rsquo;re really going wild) to store and pass around. This is where we solve our &ldquo;token too fat&rdquo; problem!</li>
<li><strong>Fast</strong>: Permission checks are simple bitwise operations like <code>$mask &amp; PERMISSION</code>, incredibly efficient for both backend and frontend.</li>
</ul>
<hr>
<h3 id="-example-checking-and-calculating-permissions--its-easy-peasy">✅ Example: Checking and Calculating Permissions – It&rsquo;s Easy Peasy!</h3>
<p>Want to see how concise checking and calculating permissions becomes? Here&rsquo;s the deal for the backend (PHP example):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?</span>php
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> PERMISSION_FLAGS <span style="color:#ff79c6">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;BLOG_CREATE&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#34;BLOG_READ&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#34;BLOG_UPDATE&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;BLOG_DELETE&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#34;COMMENT_CREATE&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">4</span>, <span style="color:#f1fa8c">&#34;DASHBOARD_ACCESS&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">5</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;PERMISSION_33&#34;</span> <span style="color:#ff79c6">=&gt;</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">32</span>
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">function</span> <span style="color:#50fa7b">calculatePermissionMask</span>(<span style="color:#ff79c6">array</span> <span style="color:#8be9fd;font-style:italic">$permissionNames</span>)<span style="color:#ff79c6">:</span> int {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">$mask</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">foreach</span> (<span style="color:#8be9fd;font-style:italic">$permissionNames</span> <span style="color:#ff79c6">as</span> <span style="color:#8be9fd;font-style:italic">$name</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (isset(PERMISSION_FLAGS[<span style="color:#8be9fd;font-style:italic">$name</span>])) { <span style="color:#8be9fd;font-style:italic">$mask</span> <span style="color:#ff79c6">|=</span> PERMISSION_FLAGS[<span style="color:#8be9fd;font-style:italic">$name</span>]; }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">$mask</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">function</span> <span style="color:#50fa7b">hasPermission</span>(int <span style="color:#8be9fd;font-style:italic">$userPermissionMask</span>, string <span style="color:#8be9fd;font-style:italic">$permissionToCheck</span>)<span style="color:#ff79c6">:</span> bool {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>isset(PERMISSION_FLAGS[<span style="color:#8be9fd;font-style:italic">$permissionToCheck</span>])) { <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> (<span style="color:#8be9fd;font-style:italic">$userPermissionMask</span> <span style="color:#ff79c6">&amp;</span> PERMISSION_FLAGS[<span style="color:#8be9fd;font-style:italic">$permissionToCheck</span>]) <span style="color:#ff79c6">!==</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">$userPermissions</span> <span style="color:#ff79c6">=</span> calculatePermissionMask([<span style="color:#f1fa8c">&#34;BLOG_READ&#34;</span>, <span style="color:#f1fa8c">&#34;COMMENT_CREATE&#34;</span>, <span style="color:#f1fa8c">&#34;DASHBOARD_ACCESS&#34;</span>, <span style="color:#f1fa8c">&#34;PERMISSION_33&#34;</span>]);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;User mask (decimal): &#34;</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$userPermissions</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;Can read blog? &#34;</span> <span style="color:#ff79c6">.</span> (hasPermission(<span style="color:#8be9fd;font-style:italic">$userPermissions</span>, <span style="color:#f1fa8c">&#34;BLOG_READ&#34;</span>) <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#34;Yes&#34;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;No&#34;</span>) <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;Can delete blog? &#34;</span> <span style="color:#ff79c6">.</span> (hasPermission(<span style="color:#8be9fd;font-style:italic">$userPermissions</span>, <span style="color:#f1fa8c">&#34;BLOG_DELETE&#34;</span>) <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#34;Yes&#34;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;No&#34;</span>) <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">?&gt;</span>
</span></span></code></pre></div><h3 id="and-for-the-frontend-vanilla-javascript">And for the Frontend (Vanilla JavaScript)</h3>
<p>Since our frontend uses these JWTs to decide what to show and hide, we need a similar setup there. Good news: bitwise operations are universal!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff79c6">const</span> PERMISSION_FLAGS_JS <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;BLOG_CREATE&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#34;BLOG_READ&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#34;BLOG_UPDATE&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;BLOG_DELETE&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#34;COMMENT_CREATE&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">4</span>, <span style="color:#f1fa8c">&#34;DASHBOARD_ACCESS&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">5</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;PERMISSION_33&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">32</span>, <span style="color:#f1fa8c">&#34;PERMISSION_64&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">63</span>
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Assume &#39;permissionMask&#39; comes from your decoded JWT payload
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">const</span> decodedJwtPayload <span style="color:#ff79c6">=</span> { <span style="color:#f1fa8c">&#34;permissionMask&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">8589934642</span> };
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">const</span> userPermissionMaskJS <span style="color:#ff79c6">=</span> decodedJwtPayload.permissionMask;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> hasPermissionJS(permissionToCheck) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>(permissionToCheck <span style="color:#ff79c6">in</span> PERMISSION_FLAGS_JS)) { <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> (userPermissionMaskJS <span style="color:#ff79c6">&amp;</span> PERMISSION_FLAGS_JS[permissionToCheck]) <span style="color:#ff79c6">!==</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>console.log(<span style="color:#f1fa8c">&#34;Can view blog module? &#34;</span>, hasPermissionJS(<span style="color:#f1fa8c">&#34;BLOG_READ&#34;</span>) <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#34;Yes!&#34;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;No.&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Dynamically showing/hiding a button
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">const</span> createBlogButton <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;createBlogButton&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> (createBlogButton) {
</span></span><span style="display:flex;"><span>    createBlogButton.style.display <span style="color:#ff79c6">=</span> hasPermissionJS(<span style="color:#f1fa8c">&#34;BLOG_CREATE&#34;</span>) <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#39;block&#39;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;none&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>console.log(<span style="color:#f1fa8c">&#34;Can access settings? &#34;</span>, hasPermissionJS(<span style="color:#f1fa8c">&#34;SETTINGS_SYSTEM_CONFIG&#34;</span>) <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#34;Yep!&#34;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Nah.&#34;</span>);
</span></span></code></pre></div><p>This logic echoes Linux’s philosophy: <strong>use bits for what they&rsquo;re best at—fast and compact access control</strong>.</p>
<hr>
<h3 id="-final-thought-bitmasking---not-just-for-old-school-geeks">🚀 Final Thought: Bitmasking - Not Just for Old-School Geeks!</h3>
<p>Bitmasking isn&rsquo;t some dusty relic from system programming textbooks – it&rsquo;s a timeless solution, pure and simple. It lets you express <strong>a ton of complexity with surprising simplicity</strong>.</p>
<p>And guess what? It directly tackles our heavy JWT problem head-on. Remember that calculation where just <strong>200-220 granular permissions</strong> could swell your JWT up to an estimated <strong>4.5KB</strong> or more, risking those annoying server errors?</p>
<p>With bitmasking, all those hundreds of permissions collapse into a <strong>highly compact numerical representation</strong> (often just one number, or a few if you&rsquo;re really piling on the permissions). The difference is night and day. Take a look at the drastic improvement in size:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Feature</th>
<th style="text-align:left">Before (String Array for 212 Permissions)</th>
<th style="text-align:left">After (Bitmask for 212+ Permissions)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Permission Representation</strong></td>
<td style="text-align:left">An array of strings: <code>[&quot;USER_CREATE&quot;, &quot;USER_READ&quot;, ...]</code></td>
<td style="text-align:left">A compact numerical value (or values): e.g., <code>9223372036854775807</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Payload Content</strong></td>
<td style="text-align:left">Thousands of characters for <code>permissions</code> array content</td>
<td style="text-align:left">Around 20-80 characters (for 1-4 integers) for numerical mask(s)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Approximate Encoded JWT Size</strong></td>
<td style="text-align:left"><strong>~4.5 KB</strong> (4500 bytes)</td>
<td style="text-align:left"><strong>~0.33 KB</strong> - <strong>~0.6 KB</strong> (330-600 bytes)</td>
</tr>
<tr>
<td style="text-align:left"><strong>HTTP Header Compatibility</strong></td>
<td style="text-align:left">Often exceeds common 4KB/8KB limits, causing errors</td>
<td style="text-align:left">Easily stays well under 1KB, no issues</td>
</tr>
</tbody>
</table>
<p>Your JWT goes from being a heavyweight contender to a featherweight champion! It&rsquo;s elegant, efficient, and as we&rsquo;ve literally just seen, a fantastic way to keep your JWTs lean, mean, and <em>actually</em> working instead of throwing <code>TooLargeRequest</code> tantrums. Give it a try!</p>
<pre tabindex="0"><code></code></pre>
  </article><div class="bg-blue-100 dark:bg-gray-900">
  <div class="container px-6 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Follow me</div>
      <p class="opacity-60">...</p>
    </div>
    <ul class="flex justify-center gap-4">
      
      <li>
        <a
          href="https://twitter.com/sonussundar"
          target="_blank"
          rel="noopener"
          aria-label="Twitter"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"
            />
          </svg>
        </a>
      </li>
      
      
      <li>
        <a
          href="https://www.linkedin.com/in/codesonus/"
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <line x1="8" y1="11" x2="8" y2="16" />
            <line x1="8" y1="8" x2="8" y2="8.01" />
            <line x1="12" y1="16" x2="12" y2="11" />
            <path d="M16 16v-3a2 2 0 0 0 -4 0" />
          </svg>
        </a>
      </li>
      
      
      <li>
        <a
                href="https://www.xing.com/profile/"
                target="_blank"
                rel="noopener"
                aria-label="xing"
                class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  fill="none"
                  stroke-linecap="round"
                  stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M14.48736,22.8L9.65664,14.33208L17.154,1.2H22.2L14.70288,14.33208L19.53384,22.8H14.48736z M6.55728,16.26888l3.74808-6.17064l-2.81088-4.9512 H2.73696l2.81112,4.9512L1.8,16.26888H6.55728z"/>
          </svg>
        </a>
      </li>
      
      
      <li>
        <a
          href="https://github.com/sonus"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>
      
      
      <li>
        <a
          href="https://medium.com/@SonusSundar"
          target="_blank"
          rel="noopener"
          aria-label="Medium"
          class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <path d="M8 9h1l3 3l3 -3h1" />
            <line x1="8" y1="15" x2="10" y2="15" />
            <line x1="14" y1="15" x2="16" y2="15" />
            <line x1="9" y1="9" x2="9" y2="15" />
            <line x1="15" y1="9" x2="15" y2="15" />
          </svg>
        </a>
      </li>
      
      
      
      
      
    </ul>
  </div>
</div>
    </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Copyright © 2024 - Sonus Sundar · All rights reserved
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>

<div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
  <div class="container max-w-3xl mx-auto p-12">
    <div class="relative">
      <div class="my-4 text-center text-2xl font-bold">Search</div>

      <span class="p-2 absolute right-0 top-0 cursor-pointer close-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </span>
    </div>

    <input type="search" class="py-2 px-3 w-full dark:text-black border dark:border-transparent"
      placeholder="Enter search query" />

    <div class="search-results text-lg font-medium my-4 hidden">Results</div>
    <ul class="search-list my-2">

    </ul>

    <div class="no-results text-center my-8 hidden">
      <div class="text-xl font-semibold mb-2">No results found</div>
      <p class="font-light text-sm">Try adjusting your search query</p>
    </div>
  </div>
</div>





<script src="http://localhost:1313/js/scripts.min.js"></script>


  






<script>
  
  const darkmode = document.querySelector('.toggle-dark-mode');
  function toggleDarkMode() {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark')
      localStorage.setItem('darkmode', 'light')
    } else {
      document.documentElement.classList.add('dark')
      localStorage.setItem('darkmode', 'dark')
    }
  }
  if (darkmode) {
    darkmode.addEventListener('click', toggleDarkMode);
  }

  const darkStorage = localStorage.getItem('darkmode');
  const isBrowserDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  if (!darkStorage && isBrowserDark) {
    document.documentElement.classList.add('dark');
  }

  if (darkStorage && darkStorage === 'dark') {
    toggleDarkMode();
  }
</script>


<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
</html>
