<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/sonus-logo.svg><title>Fixing Heavy JWTs: Bitmasking for Lean & Scalable Permissions - Sonus Sundar - Full-stack Software Engineer
</title><meta name=description content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps."><meta name=generator content="Hugo 0.128.0"><link rel=stylesheet href="https://sonus.xyz/css/styles.min.8012c7f1ea4ecd12581ee7cce34c1a878f0356557f0cc1b8422f61e8ceebe5d7.css" integrity="sha256-gBLH8epOzRJYHufM40wah48DVlV/DMG4Qi9h6M7r5dc="><style>.dark .header-path{stroke:#fff}.logo-path{stroke:#000;stroke-width:1;stroke-dasharray:100;animation:dash 3s linear infinite}@keyframes dash{to{stroke-dashoffset:1000}}</style><meta property="og:url" content="https://sonus.xyz/en/page/fix-heavy-jwts-bitmasking-scalable-permissions/"><meta property="og:site_name" content="Sonus Sundar - Full-stack Software Engineer"><meta property="og:title" content="Fixing Heavy JWTs: Bitmasking for Lean & Scalable Permissions"><meta property="og:description" content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="page"><meta property="article:published_time" content="2025-07-27T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-27T00:00:00+00:00"><meta property="article:tag" content="Fat Jwt"><meta property="article:tag" content="Heavy Jwt"><meta property="article:tag" content="Jwt"><meta property="article:tag" content="Bitmasking"><meta property="article:tag" content="413 Request Entity Too Large"><meta property="article:tag" content="414 URI Too Long"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fixing Heavy JWTs: Bitmasking for Lean & Scalable Permissions"><meta name=twitter:description content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps."><meta itemprop=name content="Fixing Heavy JWTs: Bitmasking for Lean & Scalable Permissions"><meta itemprop=description content="Are your JWTs too large with granular permissions, causing server errors? Discover how bitmasking dramatically shrinks token size for compact, fast, and scalable access control in your web apps."><meta itemprop=datePublished content="2025-07-27T00:00:00+00:00"><meta itemprop=dateModified content="2025-07-27T00:00:00+00:00"><meta itemprop=wordCount content="2449"><meta itemprop=keywords content="Fat Jwt,Heavy Jwt,Jwt,Bitmasking,413 Request Entity Too Large,414 URI Too Long,400 Bad Request,Request Header Too Large,Header Size Exceeds Configuration Limit,Client Sent Too Large Request Header,Upstream Sent Too Big Header,Request Header Fields Too Large,HTTP 431,NGINX 400 Error,NGINX 413 Error,NGINX 414 Error,Apache 431 Error,Large Request Header Error,Header Buffer Size Error,Large_headers,Oversized_request_header,Reverse Proxy Error,Web Server Error"></head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative"><a href=https://sonus.xyz/en/ class="capitalize font-extrabold text-2xl" style=transform:rotate(270deg)><svg class="max-w-full" width="100" height="120" viewBox="0 0 100 120" fill="none" xmlns="http://www.w3.org/2000/svg"><path class="logo-path" d="M20.6565 10.2626 50.3904 79.3435 79.5415 10.8006 10.2906 60.4069 50.3904 110.312l39.319-49.9051L20.6565 10.2626z"/></svg>
</a><button class="mobile-menu-button md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800"><li><a href=/en/blog>Blog</a></li><li><a href=/en/page/about/>About</a></li><li><a href=/en/tags>Tags</a></li><li class="grid place-items-center"><span class="open-search inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></span></li><li class="grid place-items-center"><span class="toggle-dark-mode inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg></span></li></ul></header><main class=flex-1><div class="relative max-w-5xl mx-auto px-4"><img src=https://picsum.photos/id/184/800/500 class="rounded-lg shadow-sm w-full object-contain"><div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">July 27, 2025</div></div><article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4"><h1 class="text-2xl font-bold mb-2">Fixing Heavy JWTs: Bitmasking for Lean & Scalable Permissions</h1><h5 class="text-sm flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2"/><line x1="16" y1="3" x2="16" y2="7"/><line x1="8" y1="3" x2="8" y2="7"/><line x1="4" y1="11" x2="20" y2="11"/><rect x="8" y="15" width="2" height="2"/></svg>
Posted on
July 27, 2025
&nbsp;&bull;&nbsp;
<svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
12&nbsp;minutes
&nbsp;&bull;
<svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 019 0 9 9 0 019 0"/><path d="M3 6a9 9 0 019 0 9 9 0 019 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
2449&nbsp;words</h5><p>Ever hit a wall with an error message that just screams, &ldquo;Dude, you&rsquo;re sending too much data!&rdquo; Or maybe your shiny, new Single Page Application (SPA) suddenly starts acting weird, requests dropping like flies? Yeah, I&rsquo;ve been there. For us, the culprit turned out to be our good old friend, the <strong>JSON Web Token (JWT)</strong>, specifically when it got absolutely <em>packed</em> with permissions and claims. What started as a neat, efficient way to handle authorization quickly spiraled into a monster that was literally too big for its britches.</p><h3 id=the-problem-when-jwts-get-greedy>The Problem: When JWTs Get Greedy</h3><p>Here&rsquo;s what I&rsquo;ve been through: I started with basic JWT claims, just <code>iss</code>, <code>exp</code>, <code>iat</code>, <code>userid</code>, and <code>email</code>. For the uninitiated, a JWT is essentially a compact, URL-safe means of representing claims to be transferred between two parties. It typically looks something like this (decoded for clarity):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#6272a4>// Example of a basic, decoded JWT payload
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>{
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;iss&#34;</span>: <span style=color:#f1fa8c>&#34;your-auth-server.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;exp&#34;</span>: <span style=color:#bd93f9>1735689600</span>, <span style=color:#6272a4>// Expiration time (e.g., Dec 31, 2024 00:00:00 GMT)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>&#34;iat&#34;</span>: <span style=color:#bd93f9>1704067200</span>, <span style=color:#6272a4>// Issued at time (e.g., Jan 1, 2024 00:00:00 GMT)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>&#34;userid&#34;</span>: <span style=color:#f1fa8c>&#34;user123&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;email&#34;</span>: <span style=color:#f1fa8c>&#34;user@example.com&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then came the permissions. Initially, permissions were straightforward. The number of permission strings depended on how many services the client opted for. For example, if a client purchased product, user, and order modules, we&rsquo;d have a few permission strings based on these services, like <code>USER_CREATE</code>, <code>USER_READ</code>, <code>USER_UPDATE</code>, <code>USER_DELETE</code>, and so on for other services. This meant our JWT payload would start to grow, potentially looking something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#6272a4>// Example of a JWT payload with basic permissions
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>{
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;iss&#34;</span>: <span style=color:#f1fa8c>&#34;your-auth-server.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;exp&#34;</span>: <span style=color:#bd93f9>1735689600</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;iat&#34;</span>: <span style=color:#bd93f9>1704067200</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;userid&#34;</span>: <span style=color:#f1fa8c>&#34;user123&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;email&#34;</span>: <span style=color:#f1fa8c>&#34;user@example.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;permissions&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;USER_CREATE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;USER_READ&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;USER_UPDATE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;USER_DELETE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;PRODUCT_VIEW&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ORDER_CREATE&#34;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We were generating good JWTs.</p><p>This was all going well until we got more services and permissions became more granular. Services could increase to include inventory, sales, reports, settings, and payments. And not just broad permissions, but really specific ones. Think <code>INVENTORY_ITEM_CREATE_BATCH</code>, <code>SALES_REPORT_VIEW_BY_REGION</code>, <code>SETTINGS_AUDIT_LOGS_ACCESS</code>. Suddenly, that <code>permissions</code> array wasn&rsquo;t just a few dozen strings; it was hundreds, sometimes thousands.</p><p>Here&rsquo;s what a JWT payload can look like when it&rsquo;s stuffed beyond recognition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#6272a4>// Example of an overstuffed JWT payload (over 4KB in JSON string length)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>{
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;iss&#34;</span>: <span style=color:#f1fa8c>&#34;your-auth-server.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;exp&#34;</span>: <span style=color:#bd93f9>1735689600</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;iat&#34;</span>: <span style=color:#bd93f9>1704067200</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;userid&#34;</span>: <span style=color:#f1fa8c>&#34;very_important_user_with_all_the_permissions_and_a_long_id&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;email&#34;</span>: <span style=color:#f1fa8c>&#34;very.important.user.with.many.roles@example.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>&#34;permissions&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;USER_CREATE&#34;</span>, <span style=color:#f1fa8c>&#34;USER_READ&#34;</span>, <span style=color:#f1fa8c>&#34;USER_UPDATE&#34;</span>, <span style=color:#f1fa8c>&#34;USER_DELETE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;PRODUCT_CREATE&#34;</span>, <span style=color:#f1fa8c>&#34;PRODUCT_READ&#34;</span>, <span style=color:#f1fa8c>&#34;PRODUCT_UPDATE&#34;</span>, <span style=color:#f1fa8c>&#34;PRODUCT_DELETE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ORDER_CREATE&#34;</span>, <span style=color:#f1fa8c>&#34;ORDER_READ&#34;</span>, <span style=color:#f1fa8c>&#34;ORDER_UPDATE&#34;</span>, <span style=color:#f1fa8c>&#34;ORDER_DELETE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;INVENTORY_ADD&#34;</span>, <span style=color:#f1fa8c>&#34;INVENTORY_REMOVE&#34;</span>, <span style=color:#f1fa8c>&#34;INVENTORY_ADJUST&#34;</span>, <span style=color:#f1fa8c>&#34;INVENTORY_VIEW&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;SALES_VIEW_OWN&#34;</span>, <span style=color:#f1fa8c>&#34;SALES_VIEW_ALL&#34;</span>, <span style=color:#f1fa8c>&#34;SALES_ANALYTICS_ACCESS&#34;</span>, <span style=color:#f1fa8c>&#34;SALES_EXPORT&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;REPORT_GENERATE_FINANCIAL&#34;</span>, <span style=color:#f1fa8c>&#34;REPORT_GENERATE_OPERATIONAL&#34;</span>, <span style=color:#f1fa8c>&#34;REPORT_VIEW_HISTORY&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;SETTINGS_USER_MANAGEMENT&#34;</span>, <span style=color:#f1fa8c>&#34;SETTINGS_ROLE_MANAGEMENT&#34;</span>, <span style=color:#f1fa8c>&#34;SETTINGS_SYSTEM_CONFIG&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;PAYMENT_PROCESS&#34;</span>, <span style=color:#f1fa8c>&#34;PAYMENT_REFUND&#34;</span>, <span style=color:#f1fa8c>&#34;PAYMENT_VOID&#34;</span>, <span style=color:#f1fa8c>&#34;PAYMENT_VIEW_TRANSACTIONS&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ... imagine hundreds or thousands more granular permissions like these:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;INVENTORY_WAREHOUSE_A_ADD&#34;</span>, <span style=color:#f1fa8c>&#34;INVENTORY_WAREHOUSE_B_ADD&#34;</span>, <span style=color:#f1fa8c>&#34;INVENTORY_ITEM_TYPE_1_VIEW&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;SALES_DASHBOARD_REGION_NORTH_VIEW&#34;</span>, <span style=color:#f1fa8c>&#34;SALES_DASHBOARD_REGION_SOUTH_VIEW&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;ORDER_APPROVE_HIGH_VALUE&#34;</span>, <span style=color:#f1fa8c>&#34;ORDER_REJECT_LOW_STOCK&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;PRODUCT_DISCOUNT_APPLY_GLOBAL&#34;</span>, <span style=color:#f1fa8c>&#34;PRODUCT_DISCOUNT_APPLY_SPECIFIC_ITEM&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;USER_AUDIT_LOG_READ&#34;</span>, <span style=color:#f1fa8c>&#34;USER_PASSWORD_RESET_FORCE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ... many, many more. This list alone could easily push the JWT well past 4KB when encoded.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=lets-talk-numbers-calculating-jwt-size>Let&rsquo;s Talk Numbers: Calculating JWT Size</h3><p>So, how does a few dozen permissions turn into a monster token? It&rsquo;s simple math, really, plus a bit of JSON and Base64 encoding overhead.</p><p>A JWT is typically composed of three parts: Header, Payload, and Signature, each Base64Url encoded and separated by dots. The size issue almost always comes down to the <strong>Payload</strong>.</p><p>Let&rsquo;s break down the approximate size contributors:</p><table><thead><tr><th style=text-align:left>Component</th><th style=text-align:left>Estimated JSON Characters/Bytes</th><th style=text-align:left>Notes</th></tr></thead><tbody><tr><td style=text-align:left><strong>JWT Header (JSON String)</strong></td><td style=text-align:left>~40 characters</td><td style=text-align:left>Example: <code>{"alg":"HS256","typ":"JWT"}</code></td></tr><tr><td style=text-align:left><strong>Fixed Payload Claims (JSON String)</strong></td><td style=text-align:left>~200 characters</td><td style=text-align:left><code>iss</code>, <code>exp</code>, <code>iat</code>, <code>userid</code>, <code>email</code>, plus the <code>permissions</code> array structure <code>{"permissions":[]}</code></td></tr><tr><td style=text-align:left><strong>Average Permission String Length</strong></td><td style=text-align:left>10 characters</td><td style=text-align:left>E.g., <code>USER_CREATE</code></td></tr><tr><td style=text-align:left><strong>Overhead per Permission in Array</strong></td><td style=text-align:left>~3 characters</td><td style=text-align:left>For quotes (<code>""</code>) and comma (<code>,</code>) in JSON, i.e., <code>"PERMISSION",</code></td></tr><tr><td style=text-align:left><strong>Effective Length per Permission in JSON Payload</strong></td><td style=text-align:left><strong>13 characters</strong></td><td style=text-align:left>(10 characters for string + 3 characters for overhead)</td></tr><tr><td style=text-align:left><strong>Base64Url Encoding Overhead</strong></td><td style=text-align:left>~33%</td><td style=text-align:left>Converts 3 bytes of raw data into 4 Base64 characters</td></tr><tr><td style=text-align:left><strong>JWT Signature (Encoded)</strong></td><td style=text-align:left>~43 bytes</td><td style=text-align:left>Fixed size for HS256 algorithm</td></tr></tbody></table><p>Now, let&rsquo;s target hitting one of those common limits. We&rsquo;ll aim for an encoded JWT size of <strong>4500 bytes (4.5 KB)</strong>, which is clearly above the safe 4KB recommendation and approaching the 8KB common limit.</p><p>Here&rsquo;s how we figure out how many permissions it takes:</p><p><strong>Step 1: Estimate the required Raw JSON Payload Size</strong></p><p>We know the final encoded JWT is roughly 1.5 times the raw JSON string length of its header and payload. So, to hit 4500 bytes:</p><table><thead><tr><th style=text-align:left>Calculation</th><th style=text-align:left>Result</th><th style=text-align:left>Explanation</th></tr></thead><tbody><tr><td style=text-align:left>Target Encoded JWT Size</td><td style=text-align:left>4500 bytes</td><td style=text-align:left>Our target to demonstrate &ldquo;too large&rdquo;</td></tr><tr><td style=text-align:left>Divided by Encoding Factor (1.5)</td><td style=text-align:left>3000 characters</td><td style=text-align:left>Approximate raw JSON size needed for Header + Payload</td></tr><tr><td style=text-align:left>Subtract Header JSON size</td><td style=text-align:left>3000 - 40 = 2960 characters</td><td style=text-align:left>Remaining characters needed for the Payload JSON string</td></tr></tbody></table><p><strong>Step 2: Calculate how many permissions fit in the remaining Payload space</strong></p><p>This remaining space (2960 characters) needs to accommodate our fixed payload claims <em>and</em> all the permission strings.</p><table><thead><tr><th style=text-align:left>Calculation</th><th style=text-align:left>Result</th><th style=text-align:left>Explanation</th></tr></thead><tbody><tr><td style=text-align:left>Payload JSON characters available for claims</td><td style=text-align:left>2960 characters</td><td style=text-align:left>From Step 1</td></tr><tr><td style=text-align:left>Subtract Fixed Payload Claims (JSON)</td><td style=text-align:left>2960 - 200 = 2760 characters</td><td style=text-align:left>Characters remaining <em>specifically</em> for the permissions array content</td></tr><tr><td style=text-align:left>Divide by Effective Length per Permission (13 chars)</td><td style=text-align:left>$2760 / 13 \approx 212$ permissions</td><td style=text-align:left>The number of 10-character permissions we can cram in</td></tr></tbody></table><p><strong>The Bottom Line:</strong></p><p>If you have around <strong>200-220 permissions</strong>, each a modest 10 characters long, your JWT could easily hit or even exceed the 4KB (4096 bytes) safe limit and rapidly approach the 8KB (8192 bytes) default HTTP header limit. That&rsquo;s not even counting any other custom claims you might add!</p><hr><h3 id=spotting-the-problem-common-error-messages>Spotting the Problem: Common Error Messages</h3><p>So, you&rsquo;re hitting these limits. What does it actually <em>look</em> like when your JWTs get too heavy? It usually results in some pretty gnarly error messages from your server or proxy, often before your request even hits your application code. If you see any of these, your oversized JWT is probably the culprit:</p><ul><li><p><strong>NGINX:</strong></p><ul><li><code>400 Bad Request</code> (often accompanied by a log message like <code>client sent too large request header</code>)</li><li><code>413 Request Entity Too Large</code></li><li><code>414 Request-URI Too Large</code></li><li>You might also see <code>upstream sent too big header while reading response header from upstream</code> in your NGINX error logs, indicating an issue with a response from your backend services.</li></ul></li><li><p><strong>Apache:</strong></p><ul><li><code>431 Request Header Fields Too Large</code> (This one is super specific and a dead giveaway!)</li><li><code>400 Bad Request</code></li></ul></li><li><p><strong>Caddy / Other Proxies/Servers:</strong></p><ul><li>Expect to see errors similar to Apache&rsquo;s <code>431</code> or generic <code>400 Bad Request</code>.</li><li>In server logs, keep an eye out for internal messages like <code>"header too large"</code>, <code>"request header exceeded limit"</code>, or <code>"max header size exceeded"</code>.</li></ul></li></ul><p>If you&rsquo;re seeing any of these, especially if you&rsquo;re stuffing a lot of data into your JWTs, it&rsquo;s time to consider a more compact approach.</p><hr><h3 id=solution-bitmasking-to-the-rescue>Solution: Bitmasking to the Rescue!</h3><p>Okay, so we&rsquo;ve got this chunky JWT problem. What&rsquo;s the fix? Well, I gotta tell you, I was doing some digging, and I stumbled across how Linux handles permissions using bitmasking—it&rsquo;s both efficient and incredibly scalable. Lightbulb moment! I figured, &ldquo;Hey, if it works for Linux, why can&rsquo;t we use this magic for our JWT permissions, especially now that they&rsquo;re multiplying like rabbits?&rdquo;</p><hr><h3 id=-from-linux-permissions-to-our-lean-mean-jwt-system>🔐 From Linux Permissions to Our Lean, Mean JWT System</h3><p>So, imagine this: Linux file permissions. Total classic example of bitmasking doing its thing. You know, <strong>read (r)</strong>, <strong>write (w)</strong>, and <strong>execute (x)</strong>? Each one of those gets its own little spot, its own specific bit. You combine &rsquo;em, and boom – you&rsquo;ve got a permission mask. Check this out:</p><table><thead><tr><th style=text-align:left>Role</th><th style=text-align:left>Binary</th><th style=text-align:left>Octal</th><th style=text-align:left>Symbolic</th></tr></thead><tbody><tr><td style=text-align:left>Owner</td><td style=text-align:left>111</td><td style=text-align:left>7</td><td style=text-align:left>rwx</td></tr><tr><td style=text-align:left>Group</td><td style=text-align:left>101</td><td style=text-align:left>5</td><td style=text-align:left>r-x</td></tr><tr><td style=text-align:left>Others</td><td style=text-align:left>101</td><td style=text-align:left>5</td><td style=text-align:left>r-x</td></tr></tbody></table><p>So, if you see a permission like <code>755</code>, it&rsquo;s basically shorthand for:</p><pre tabindex=0><code>Owner: rwx (7)
Group: r-x (5)
Others: r-x (5)
=&gt; Or, if you&#39;re into binary: 111 101 101
</code></pre><p>See? Each tiny bit screams out a specific capability. Mash &rsquo;em together, and you get these super powerful, super compact ways to say who can do what. Pretty neat, right?</p><p>That efficiency totally lit a fire under me. I thought, &ldquo;Let&rsquo;s apply this brilliance!&rdquo; So, I cooked up a <strong>JWT-based permission model using bitmasking</strong> in PHP. Instead of slapping in a bunch of separate <code>true</code>/<code>false</code> flags for every single permission (which, as we saw, makes JWTs huge), we just assign each permission a unique bit. It&rsquo;s like <code>1 &lt;&lt; n</code>, where <code>n</code> is its position, just like those Linux permissions.</p><p>Here&rsquo;s a little peek at how we set up our permission flags:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>const</span> PERMISSION_FLAGS <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_CREATE&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>0</span>,  <span style=color:#6272a4>// That&#39;s 2^0 = 1. Simple, right?
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;BLOG_READ&#34;</span>   <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>1</span>,  <span style=color:#6272a4>// And 2^1 = 2
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;BLOG_UPDATE&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>2</span>,  <span style=color:#6272a4>// You guessed it: 2^2 = 4
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// ... and so on. We can keep going...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;PERMISSION_64&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>63</span> <span style=color:#6272a4>// That&#39;s a whopping 2^63! Seriously, this number is huge.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>];
</span></span></code></pre></div><h4 id=-why-this-works-so-darn-well>🔍 Why this works so darn well:</h4><ul><li><strong>Scalable</strong>: We&rsquo;re talking up to 64 distinct permissions in a <em>single</em> 64-bit integer. Need more? You <em>can</em> technically chain a few of these, but honestly, 64 is often more than enough for many super granular systems.</li><li><strong>Compact</strong>: This is the real MVP, folks! We only need one integer (or maybe a couple, if you&rsquo;re really going wild with permissions) to store and pass around. Stick <em>that</em> in your JWT! This is exactly how we solve our &ldquo;token too fat&rdquo; problem.</li><li><strong>Fast</strong>: Forget sluggish checks! Permission verification is just quick bitwise operations like <code>$mask & PERMISSION</code>. These are incredibly fast, whether you&rsquo;re validating on the backend or just showing/hiding stuff on your snappy frontend UI.</li></ul><hr><h3 id=-example-checking-and-calculating-permissions--its-easy-peasy>✅ Example: Checking and Calculating Permissions – It&rsquo;s Easy Peasy!</h3><p>Want to see how concise checking and calculating permissions becomes? Here&rsquo;s the deal for the backend (PHP example):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#ff79c6>&lt;?</span>php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Our list of permissions and their corresponding bit flags
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> PERMISSION_FLAGS <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_CREATE&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_READ&#34;</span>   <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_UPDATE&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_DELETE&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>3</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;COMMENT_CREATE&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>4</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;DASHBOARD_ACCESS&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>5</span>,
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;PERMISSION_33&#34;</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>32</span> <span style=color:#6272a4>// Just an example for a higher bit
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// ... more permissions would go here
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Imagine we have a function to mash together all a user&#39;s permissions
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>function</span> <span style=color:#50fa7b>calculatePermissionMask</span>(<span style=color:#ff79c6>array</span> <span style=color:#8be9fd;font-style:italic>$permissionNames</span>)<span style=color:#ff79c6>:</span> int {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>$mask</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; <span style=color:#6272a4>// Start with nothing
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>foreach</span> (<span style=color:#8be9fd;font-style:italic>$permissionNames</span> <span style=color:#ff79c6>as</span> <span style=color:#8be9fd;font-style:italic>$name</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (isset(PERMISSION_FLAGS[<span style=color:#8be9fd;font-style:italic>$name</span>])) {
</span></span><span style=display:flex><span>            <span style=color:#8be9fd;font-style:italic>$mask</span> <span style=color:#ff79c6>|=</span> PERMISSION_FLAGS[<span style=color:#8be9fd;font-style:italic>$name</span>]; <span style=color:#6272a4>// OR the bits together. Magic!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>$mask</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// And another function to see if they have a specific permission
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>function</span> <span style=color:#50fa7b>hasPermission</span>(int <span style=color:#8be9fd;font-style:italic>$userPermissionMask</span>, string <span style=color:#8be9fd;font-style:italic>$permissionToCheck</span>)<span style=color:#ff79c6>:</span> bool {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>isset(PERMISSION_FLAGS[<span style=color:#8be9fd;font-style:italic>$permissionToCheck</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>; <span style=color:#6272a4>// Oops, permission not even defined!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Is the permission&#39;s bit set in the user&#39;s mask?
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>return</span> (<span style=color:#8be9fd;font-style:italic>$userPermissionMask</span> <span style=color:#ff79c6>&amp;</span> PERMISSION_FLAGS[<span style=color:#8be9fd;font-style:italic>$permissionToCheck</span>]) <span style=color:#ff79c6>!==</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// --- Let&#39;s see it in action! ---
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>$userPermissions</span> <span style=color:#ff79c6>=</span> calculatePermissionMask([
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_READ&#34;</span>, <span style=color:#f1fa8c>&#34;COMMENT_CREATE&#34;</span>, <span style=color:#f1fa8c>&#34;DASHBOARD_ACCESS&#34;</span>, <span style=color:#f1fa8c>&#34;PERMISSION_33&#34;</span>
</span></span><span style=display:flex><span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>echo</span> <span style=color:#f1fa8c>&#34;Our user&#39;s permission mask looks like this (in decimal): &#34;</span> <span style=color:#ff79c6>.</span> <span style=color:#8be9fd;font-style:italic>$userPermissions</span> <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#6272a4>// For the example flags, this would output 8589934592 + 32 + 2 + 16 = 8589934642.
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// The important part is it&#39;s a *single* integer!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>echo</span> <span style=color:#f1fa8c>&#34;Can our user read the blog? &#34;</span> <span style=color:#ff79c6>.</span> (hasPermission(<span style=color:#8be9fd;font-style:italic>$userPermissions</span>, <span style=color:#f1fa8c>&#34;BLOG_READ&#34;</span>) <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#34;Absolutely!&#34;</span> <span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Nope.&#34;</span>) <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;      <span style=color:#6272a4>// True, because they have it!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>echo</span> <span style=color:#f1fa8c>&#34;Can our user delete the blog? &#34;</span> <span style=color:#ff79c6>.</span> (hasPermission(<span style=color:#8be9fd;font-style:italic>$userPermissions</span>, <span style=color:#f1fa8c>&#34;BLOG_DELETE&#34;</span>) <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#34;Yep!&#34;</span> <span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Nah.&#34;</span>) <span style=color:#ff79c6>.</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;    <span style=color:#6272a4>// False. Not in their mask.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>?&gt;</span>
</span></span></code></pre></div><h3 id=and-for-the-frontend-vanilla-javascript>And for the Frontend (Vanilla JavaScript)</h3><p>Since our frontend is also in on the action, using these JWTs to decide what to show and hide, we need a similar setup there. Good news: bitwise operations are universal!</p><p>First, you&rsquo;d probably have your <code>PERMISSION_FLAGS</code> defined somewhere accessible, maybe loaded from a config or part of your build process.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#6272a4>// This would typically come from your backend or a shared config
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// Make sure these match the backend&#39;s flags!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> PERMISSION_FLAGS_JS <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;BLOG_CREATE&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>0</span>,  <span style=color:#6272a4>// 1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;BLOG_READ&#34;</span><span style=color:#ff79c6>:</span>   <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>1</span>,  <span style=color:#6272a4>// 2
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;BLOG_UPDATE&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>2</span>,  <span style=color:#6272a4>// 4
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;BLOG_DELETE&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>3</span>,  <span style=color:#6272a4>// 8
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;COMMENT_CREATE&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>4</span>, <span style=color:#6272a4>// 16
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;DASHBOARD_ACCESS&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>5</span>, <span style=color:#6272a4>// 32
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;PERMISSION_33&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>32</span>, <span style=color:#6272a4>// For demonstration of higher bits
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#f1fa8c>&#34;PERMISSION_64&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>1</span> <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>63</span> <span style=color:#6272a4>// Yeah, JS handles these big numbers fine as BigInt if needed,
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>                             <span style=color:#6272a4>// but for 63 bits, standard numbers usually work up to 2^53.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>                             <span style=color:#6272a4>// For larger, you might use BigInt(1) &lt;&lt; BigInt(63).
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Imagine our JWT payload is decoded and looks like this:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> decodedJwtPayload <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// ... other claims ...
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#f1fa8c>&#34;permissionMask&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#bd93f9>8589934642</span> <span style=color:#6272a4>// This is the single integer from the backend, matching the example!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Let&#39;s grab that mask from our (dummy) JWT payload
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> userPermissionMaskJS <span style=color:#ff79c6>=</span> decodedJwtPayload.permissionMask; <span style=color:#6272a4>// Or wherever you extract it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Function to check if the user has a specific permission
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>function</span> hasPermissionJS(permissionToCheck) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>(permissionToCheck <span style=color:#ff79c6>in</span> PERMISSION_FLAGS_JS)) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>; <span style=color:#6272a4>// Permission not defined on frontend
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Is the permission&#39;s bit set in the user&#39;s mask?
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// The bitwise AND (&amp;) operation is your friend here!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>return</span> (userPermissionMaskJS <span style=color:#ff79c6>&amp;</span> PERMISSION_FLAGS_JS[permissionToCheck]) <span style=color:#ff79c6>!==</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// --- How the Frontend uses it for UI! ---
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>console.log(<span style=color:#f1fa8c>&#34;Can user view blog module? &#34;</span>, hasPermissionJS(<span style=color:#f1fa8c>&#34;BLOG_READ&#34;</span>) <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#34;Yes!&#34;</span> <span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;No.&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#6272a4>// Example: Dynamically showing/hiding a button
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> createBlogButton <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#39;createBlogButton&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> (createBlogButton) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (hasPermissionJS(<span style=color:#f1fa8c>&#34;BLOG_CREATE&#34;</span>)) {
</span></span><span style=display:flex><span>        createBlogButton.style.display <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;block&#39;</span>; <span style=color:#6272a4>// Show the button
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>        createBlogButton.style.display <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;none&#39;</span>; <span style=color:#6272a4>// Hide it!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>&#34;Can user access settings? &#34;</span>, hasPermissionJS(<span style=color:#f1fa8c>&#34;SETTINGS_SYSTEM_CONFIG&#34;</span>) <span style=color:#ff79c6>?</span> <span style=color:#f1fa8c>&#34;Yep!&#34;</span> <span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;Nah.&#34;</span>); <span style=color:#6272a4>// Assuming this flag exists
</span></span></span></code></pre></div><p>This logic echoes Linux’s philosophy: <strong>use bits for what they&rsquo;re best at—fast and compact access control</strong>.</p><hr><h3 id=-final-thought-bitmasking---not-just-for-old-school-geeks>🚀 Final Thought: Bitmasking - Not Just for Old-School Geeks!</h3><p>Bitmasking isn&rsquo;t some dusty relic from system programming textbooks – it&rsquo;s a timeless solution, pure and simple. Whether you&rsquo;re wrangling file access in Linux or trying to keep user permissions in check for your shiny, modern web apps, it&rsquo;s a seriously powerful tool. It lets you express <strong>a ton of complexity with surprising simplicity</strong>.</p><p>And guess what? It directly tackles our heavy JWT problem head-on. Remember that calculation where just <strong>200-220 granular permissions</strong> could swell your JWT up to an estimated <strong>4.5KB</strong> or more, risking those annoying &lsquo;TooLongFrameException&rsquo; errors?</p><p>With bitmasking, all those hundreds of permissions collapse into a <em>single</em> integer. The difference is night and day. Take a look at the drastic improvement in size:</p><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left>Before (String Array for 212 Permissions)</th><th style=text-align:left>After (Bitmask for 212+ Permissions)</th></tr></thead><tbody><tr><td style=text-align:left><strong>Permission Representation</strong></td><td style=text-align:left>An array of strings: <code>["USER_CREATE", "USER_READ", ..., "PERMISSION_212"]</code></td><td style=text-align:left>A single integer: <code>"permissionMask":9223372036854775807</code></td></tr><tr><td style=text-align:left><strong>Payload Content</strong></td><td style=text-align:left>Thousands of characters for <code>permissions</code> array content</td><td style=text-align:left>Around 20 characters for a 64-bit integer string representation</td></tr><tr><td style=text-align:left><strong>Approximate Encoded JWT Size</strong></td><td style=text-align:left><strong>~4.5 KB</strong> (4500 bytes)</td><td style=text-align:left><strong>~0.33 KB</strong> (330 bytes)</td></tr><tr><td style=text-align:left><strong>HTTP Header Compatibility</strong></td><td style=text-align:left>Often exceeds common 4KB/8KB limits, causing errors</td><td style=text-align:left>Easily stays well under 1KB (or even a few hundred bytes), no issues</td></tr></tbody></table><p>Your JWT goes from being a heavyweight contender to a featherweight champion! It&rsquo;s elegant, efficient, and as we&rsquo;ve literally just seen, a fantastic way to keep your JWTs lean, mean, and <em>actually</em> working instead of throwing <code>'TooLongFrameException'</code> tantrums. Give it a try!</p></article><div class="bg-blue-100 dark:bg-gray-900"><div class="container px-6 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-8 items-center"><div><div class="text-2xl font-bold mb-2">Follow me</div><p class=opacity-60>...</p></div><ul class="flex justify-center gap-4"><li><a href=https://twitter.com/sonussundar target=_blank rel=noopener aria-label=Twitter class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://www.linkedin.com/in/codesonus/ target=_blank rel=noopener aria-label=LinkedIn class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://www.xing.com/profile/ target=_blank rel=noopener aria-label=xing class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.48736 22.8 9.65664 14.33208 17.154 1.2H22.2L14.70288 14.33208 19.53384 22.8H14.48736zM6.55728 16.26888l3.74808-6.17064-2.81088-4.9512H2.73696l2.81112 4.9512L1.8 16.26888H6.55728z"/></svg></a></li><li><a href=https://github.com/sonus target=_blank rel=noopener aria-label=GitHub class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://medium.com/@SonusSundar target=_blank rel=noopener aria-label=Medium class="p-2 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M8 9h1l3 3 3-3h1"/><line x1="8" y1="15" x2="10" y2="15"/><line x1="14" y1="15" x2="16" y2="15"/><line x1="9" y1="9" x2="9" y2="15"/><line x1="15" y1="9" x2="15" y2="15"/></svg></a></li></ul></div></div></main><footer class="container p-6 mx-auto flex justify-between items-center"><span class="text-sm font-light">Copyright © 2024 - Sonus Sundar · All rights reserved
</span><span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg></span></footer><div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden"><div class="container max-w-3xl mx-auto p-12"><div class=relative><div class="my-4 text-center text-2xl font-bold">Search</div><span class="p-2 absolute right-0 top-0 cursor-pointer close-search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></div><input type=search class="py-2 px-3 w-full dark:text-black border dark:border-transparent" placeholder="Enter search query"><div class="search-results text-lg font-medium my-4 hidden">Results</div><ul class="search-list my-2"></ul><div class="no-results text-center my-8 hidden"><div class="text-xl font-semibold mb-2">No results found</div><p class="font-light text-sm">Try adjusting your search query</p></div></div></div><script src=https://sonus.xyz/js/scripts.min.js></script><script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script><script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script></body></html>